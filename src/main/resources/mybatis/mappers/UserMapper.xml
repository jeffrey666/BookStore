<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.tarena.book.mapper.UserMapper">


    
    
    <insert id="saveBookUpload" >
    insert into user_book_borrower (user_id,book_id) values(#{userId},#{bookId})
    </insert>

	<sql id="findAllUser_sql">
		SELECT * FROM
		user
		LEFT JOIN
		user_info
		ON
		`user`.id = user_info.user_info_id
	</sql>


	<resultMap type="User" id="user_rm" autoMapping="true">
		<id column="id" property="id" />
		<association property="userInfo" javaType="UserInfo">
			<id column="user_info_id" property="userInfoId" />
			<result column="nickname" property="nickname" />
			<result column="email" property="email" />
			<result column="address" property="address" />
			<result column="cardNo" property="cardNo" />
			<result column="score" property="score" />
			<result column="telephone" property="telephone" />
			<result column="gender" property="gender" />
		</association>
	</resultMap>

	<select id="findAllUser" resultMap="user_rm">
		<include refid="findAllUser_sql"></include>
	</select>
	
	<select id="findUserById" resultMap="user_rm"  >
		<include refid="findAllUser_sql"></include> WHERE id = #{user_id}
	</select>
	
	<select id="findUserByIdAndPsw" resultMap="user_rm"  >
		<include refid="findAllUser_sql"></include> WHERE id = #{id} and password = #{password}
	</select>	
	
	<update id="updatePsw">
		UPDATE user
		SET password = #{newPassword}
		WHERE
		id = #{userId}
	</update>		


	<!--根据用户名和密码查询该用户是否存在-->
	<select id="findUser" resultType="cn.tarena.book.pojo.User">
		select * from user where username=#{username} and password=#{password}
	</select>
</mapper>